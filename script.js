/* MENU DATA and cart logic */
const MENU = { food:[['hamburger',250],['Noodle',200],['patatine',250],['mela',200],['banana',200],['ciambella',200],['p\'s & q\'s',200],['tacos',250],['Gelato al cacao',250],['Patatine Fritte',250],['Burger semplice',300],['Burger doppia farcitura',300],['Burger Glorius',300],['Burger Maxi',400],['Burger Doppio',300],['Wrap',250],['Gelato',250],['jumbo',400],['Meteorite',250],['Hot Dog',250],['Patatine Grandi',300]], drinks:[['Coca-Cola',300],['New Energy Drink',250],['Caffè',250],['Emerals Caffè',200],['Succo Di Frutta',200],['Ketchup',250],['Acqua',150],['Tea',200],['Latte',200]], alc:[['Amaro Kyma',2500],['Vodka',2500],['Whiskey',2500],['Cognac',2500],['Mac Beth',2500],['Tequila',2500],['Rum',2500]], combos:[['1x1',900],['2x2',1400],['5x5',3000],['10x10',6000],['20x20',15000],['50x50',40000],['100x100',80000],['200x200',110000],['300x300',160000],['400x400',200000],['500x500',300000]]}; const RENT = { normal:[['20 Min',25000],['40 Min',45000],['60 Min',160000],['120 Min',220000],['240 Min',460000]], luxury:[['20 Min',45000],['40 Min',90000],['60 Min',180000],['120 Min',280000],['240 Min',480000]], helo:[['20 Min',25000],['40 Min',45000],['60 Min',150000],['120 Min',240000],['240 Min',460000]]}; let cart = JSON.parse(localStorage.getItem('lux_cart')||'[]'); function saveCart(){ localStorage.setItem('lux_cart', JSON.stringify(cart)); } function addToCart(name,price,qty=1){ const found = cart.find(i=>i.name===name && i.price===price); if(found) found.qty += qty; else cart.push({ name, price, qty }); saveCart(); renderCart(); } function removeFromCart(idx){ cart.splice(idx,1); saveCart(); renderCart(); } function renderCart(){ const el = document.getElementById('cart'); if(!el) return; el.innerHTML=''; let total=0; cart.forEach((it,idx)=>{ total += it.price*it.qty; const row = document.createElement('div'); row.className='cart-row'; row.innerHTML = `<div>${it.name} x${it.qty}</div><div>${it.price*it.qty}$ <button onclick="removeFromCart(${idx})">✖</button></div>`; el.appendChild(row); }); document.getElementById('total').textContent = total; } function populateMenuLists(){ const mapList = (arr, elid)=>{ const el=document.getElementById(elid); if(!el) return; arr.forEach(([name,price])=>{ const card = document.createElement('div'); card.className='card'; card.innerHTML = `<div class="item-name">${name}</div><div class="item-price">${price}$</div><div style="margin-top:8px"><button onclick='addToCart("${name}",${price},1)'>Aggiungi</button></div>`; el.appendChild(card); }); }; mapList(MENU.food,'food-list'); mapList(MENU.drinks,'drinks-list'); mapList(MENU.alc,'alc-list'); const combosEl = document.getElementById('combos-list'); if(combosEl) MENU.combos.forEach(([n,p])=>{ const c=document.createElement('div'); c.className='card'; c.innerHTML=`<div class="item-name">${n}</div><div class="item-price">${p}$</div><div style="margin-top:8px"><button onclick='addToCart("${n}",${p},1)'>Aggiungi</button></div>`; combosEl.appendChild(c); }); const mapRent=(arr, id)=>{ const el=document.getElementById(id); if(!el) return; arr.forEach(([n,p])=>{ const c=document.createElement('div'); c.className='card'; c.innerHTML=`<div class="item-name">${n}</div><div class="item-price">${p}$</div><div style="margin-top:8px"><button onclick='addToCart("${n}",${p},1)'>Prenota</button></div>`; el.appendChild(c); }); }; mapRent(RENT.normal,'rent-normal'); mapRent(RENT.luxury,'rent-lux'); mapRent(RENT.helo,'rent-helo'); const qp = document.getElementById('quick-products'); if(qp){ const all = [].concat(MENU.food,MENU.drinks,MENU.alc); all.slice(0,12).forEach(([n,p])=>{ const b=document.createElement('div'); b.className='card'; b.innerHTML=`<div class="item-name">${n}</div><div class="item-price">${p}$</div><div style="margin-top:8px"><button onclick='addToCart("${n}",${p},1)'>Aggiungi</button></div>`; qp.appendChild(b); }); } } async function checkout(){ if(cart.length===0) return alert('Carrello vuoto'); const serviceType = document.getElementById('serviceType').value; const tableNumber = document.getElementById('tableNumber').value || ''; const name = document.getElementById('clientName').value || 'Anonimo'; const address = document.getElementById('clientAddress').value || ''; const notes = document.getElementById('notes').value || ''; let total = cart.reduce((s,i)=>s + i.price*i.qty,0); if(serviceType==='domicilio') total += 10000; if(serviceType==='fuori') total += 20000; const payload = { name, items: cart, total, serviceType, tableNumber, address, notes }; const res = await fetch('/api/order', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) }); if(res.ok){ const j=await res.json(); document.getElementById('orderStatus').textContent = 'Ordine inviato! ID: '+(j.id||''); cart = []; saveCart(); renderCart(); } else { alert('Errore invio'); } } window.addEventListener('load', ()=>{ populateMenuLists(); renderCart(); document.getElementById('checkout')?.addEventListener('click', checkout); });